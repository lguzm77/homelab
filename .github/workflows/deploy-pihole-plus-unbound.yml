---
name: deploy-pihole-plus-unbound
on:
  push:
    paths: [pi-hole/**]
    branches: [main]
  workflow_dispatch:
jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: clean old checkout
        run: sudo chmod +w -R ${GITHUB_WORKSPACE}; sudo rm -rf ${GITHUB_WORKSPACE}/*;
      - uses: actions/checkout@v4
      - name: deploy pihole plus unbound
        env:
          PIHOLE_PASSWORD: ${{ secrets.PIHOLE_PASSWORD }}
        run: cd ./pi-hole; docker compose down && docker compose up -d --remove-orphans
